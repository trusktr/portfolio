
import styles from './HTMLScene.style'
import Motor from '../core/Motor'
import Scene from '../core/Scene'
import Observable from '../core/Observable'
import Sizeable from '../core/Sizeable'
import getWebGlRenderer from '../core/WebGLRenderer'
import DeclarativeBase, {initDeclarativeBase, proxyGettersSetters} from './DeclarativeBase'
import sleep from 'awaitbox/timers/sleep'

//import * as PIXI from 'pixi.js' // also sets the PIXI global.
//import SVG from 'pixi-svg' // uses the PIXI global, won't work if you don't import the main `pixi.js module`.
import Two from 'two.js/build/two'

initDeclarativeBase()

const privates = new WeakMap()
const _ = instance => {
    if (!privates.get(instance)) { privates.set(instance, {}) }
    return privates.get(instance)
}

class HTMLScene extends Observable.mixin(DeclarativeBase) {
    static define(name) {
        customElements.define(name || 'i-scene', HTMLScene)
    }

    constructor() {
        super()

        this._sizePollTask = null
        this._parentSize = {x:0, y:0, z:0}

        // After the imperativeCounterpart is available it needs to register
        // mount into DOM. This is only for MotorHTMLScenes because their
        // imperativeCounterparts are not added to a parent Node.
        // MotorHTMLNodes get their parent connection from their parent in
        // childConnectedCallback.
        this._imperativeCounterpartPromise
            .then(() => {
                if (this.imperativeCounterpart._mounted) { return }

                if (this.parentNode)
                    { this.imperativeCounterpart.mount(this.parentNode) }
            })

        // For now, use the same program (with shaders) for all objects.
        // Basically it has position, frag colors, point light, directional
        // light, and ambient light.
        // TODO: maybe call this in `init()`, and destroy webgl stuff in
        // `deinit()`.
        // TODO: The user might enable this by setting the attribute later, so
        // we can't simply rely on having it in constructor, we need a
        // getter/setter like node properties.
        this.initWebGl()
    }

    // TODO: we need to deinit webgl too.
    initWebGl() {
        // TODO: this needs to be cancelable too, search other codes for
        // "mountcancel" to see.
        this.mountPromise.then(() => {
            this.webglEnabled = !!this.getAttribute('webglenabled')
            if (!this.webglEnabled) { return }
            this.webGlRendererState = {}
            getWebGlRenderer().initGl(this)
        })
    }
    //async initWebGl() {
        //// TODO: this needs to be cancelable too, search other codes for
        //// "mountcancel" to see.
        //await this.mountPromise
        //this.webglEnabled = !!this.getAttribute('webglenabled')
        //if (!this.webglEnabled) return
        //this.webGlRendererState = {}
        //getWebGlRenderer().initGl(this)
    //}

    _startSizePolling() {
        // NOTE Polling is currently required because there's no other way to do this
        // reliably, not even with MutationObserver. ResizeObserver hasn't
        // landed in browsers yet.
        if (!this._sizePollTask)
            { this._sizePollTask = Motor.addRenderTask(this._checkSize.bind(this)) }
    }

    // NOTE, the Z dimension of a scene doesn't matter, it's a flat plane, so
    // we haven't taken that into consideration here.
    _checkSize() {

        // The scene has a parent by the time this is called (see
        // src/core/Scene#mount where _startSizePolling is called)
        const parent = this.parentNode
        const parentSize = this._parentSize
        const style = getComputedStyle(parent)
        const width = parseFloat(style.width)
        const height = parseFloat(style.height)

        // if we have a size change, trigger parentsizechange
        if (parentSize.x != width || parentSize.y != height) {
            parentSize.x = width
            parentSize.y = height

            this.triggerEvent('parentsizechange', Object.assign({}, parentSize))
        }
    }

    _makeImperativeCounterpart() {
        return new Scene({
            _motorHtmlCounterpart: this
        })
    }

    /** @override */
    getStyles() {
        return styles
    }

    deinit() {
        super.deinit()

        this.imperativeCounterpart.unmount()
    }

    _stopSizePolling() {
        Motor.removeRenderTask(this._sizePollTask)
        this._sizePollTask = null
    }
}

// This associates the Transformable getters/setters with the HTML-API classes,
// so that the same getters/setters can be called from HTML side of the API.
proxyGettersSetters(Sizeable, HTMLScene)

export {HTMLScene as default}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSFRNTFNjZW5lLmpzIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaHRtbC9IVE1MU2NlbmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4vSFRNTFNjZW5lLnN0eWxlJ1xuaW1wb3J0IE1vdG9yIGZyb20gJy4uL2NvcmUvTW90b3InXG5pbXBvcnQgU2NlbmUgZnJvbSAnLi4vY29yZS9TY2VuZSdcbmltcG9ydCBPYnNlcnZhYmxlIGZyb20gJy4uL2NvcmUvT2JzZXJ2YWJsZSdcbmltcG9ydCBTaXplYWJsZSBmcm9tICcuLi9jb3JlL1NpemVhYmxlJ1xuaW1wb3J0IGdldFdlYkdsUmVuZGVyZXIgZnJvbSAnLi4vY29yZS9XZWJHTFJlbmRlcmVyJ1xuaW1wb3J0IERlY2xhcmF0aXZlQmFzZSwge2luaXREZWNsYXJhdGl2ZUJhc2UsIHByb3h5R2V0dGVyc1NldHRlcnN9IGZyb20gJy4vRGVjbGFyYXRpdmVCYXNlJ1xuaW1wb3J0IHNsZWVwIGZyb20gJ2F3YWl0Ym94L3RpbWVycy9zbGVlcCdcblxuLy9pbXBvcnQgKiBhcyBQSVhJIGZyb20gJ3BpeGkuanMnIC8vIGFsc28gc2V0cyB0aGUgUElYSSBnbG9iYWwuXG4vL2ltcG9ydCBTVkcgZnJvbSAncGl4aS1zdmcnIC8vIHVzZXMgdGhlIFBJWEkgZ2xvYmFsLCB3b24ndCB3b3JrIGlmIHlvdSBkb24ndCBpbXBvcnQgdGhlIG1haW4gYHBpeGkuanMgbW9kdWxlYC5cbmltcG9ydCBUd28gZnJvbSAndHdvLmpzL2J1aWxkL3R3bydcblxuaW5pdERlY2xhcmF0aXZlQmFzZSgpXG5cbmNvbnN0IHByaXZhdGVzID0gbmV3IFdlYWtNYXAoKVxuY29uc3QgXyA9IGluc3RhbmNlID0+IHtcbiAgICBpZiAoIXByaXZhdGVzLmdldChpbnN0YW5jZSkpIHByaXZhdGVzLnNldChpbnN0YW5jZSwge30pXG4gICAgcmV0dXJuIHByaXZhdGVzLmdldChpbnN0YW5jZSlcbn1cblxuY2xhc3MgSFRNTFNjZW5lIGV4dGVuZHMgT2JzZXJ2YWJsZS5taXhpbihEZWNsYXJhdGl2ZUJhc2UpIHtcbiAgICBzdGF0aWMgZGVmaW5lKG5hbWUpIHtcbiAgICAgICAgY3VzdG9tRWxlbWVudHMuZGVmaW5lKG5hbWUgfHwgJ2ktc2NlbmUnLCBIVE1MU2NlbmUpXG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKClcblxuICAgICAgICB0aGlzLl9zaXplUG9sbFRhc2sgPSBudWxsXG4gICAgICAgIHRoaXMuX3BhcmVudFNpemUgPSB7eDowLCB5OjAsIHo6MH1cblxuICAgICAgICAvLyBBZnRlciB0aGUgaW1wZXJhdGl2ZUNvdW50ZXJwYXJ0IGlzIGF2YWlsYWJsZSBpdCBuZWVkcyB0byByZWdpc3RlclxuICAgICAgICAvLyBtb3VudCBpbnRvIERPTS4gVGhpcyBpcyBvbmx5IGZvciBNb3RvckhUTUxTY2VuZXMgYmVjYXVzZSB0aGVpclxuICAgICAgICAvLyBpbXBlcmF0aXZlQ291bnRlcnBhcnRzIGFyZSBub3QgYWRkZWQgdG8gYSBwYXJlbnQgTm9kZS5cbiAgICAgICAgLy8gTW90b3JIVE1MTm9kZXMgZ2V0IHRoZWlyIHBhcmVudCBjb25uZWN0aW9uIGZyb20gdGhlaXIgcGFyZW50IGluXG4gICAgICAgIC8vIGNoaWxkQ29ubmVjdGVkQ2FsbGJhY2suXG4gICAgICAgIHRoaXMuX2ltcGVyYXRpdmVDb3VudGVycGFydFByb21pc2VcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbXBlcmF0aXZlQ291bnRlcnBhcnQuX21vdW50ZWQpIHJldHVyblxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSlcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbXBlcmF0aXZlQ291bnRlcnBhcnQubW91bnQodGhpcy5wYXJlbnROb2RlKVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAvLyBGb3Igbm93LCB1c2UgdGhlIHNhbWUgcHJvZ3JhbSAod2l0aCBzaGFkZXJzKSBmb3IgYWxsIG9iamVjdHMuXG4gICAgICAgIC8vIEJhc2ljYWxseSBpdCBoYXMgcG9zaXRpb24sIGZyYWcgY29sb3JzLCBwb2ludCBsaWdodCwgZGlyZWN0aW9uYWxcbiAgICAgICAgLy8gbGlnaHQsIGFuZCBhbWJpZW50IGxpZ2h0LlxuICAgICAgICAvLyBUT0RPOiBtYXliZSBjYWxsIHRoaXMgaW4gYGluaXQoKWAsIGFuZCBkZXN0cm95IHdlYmdsIHN0dWZmIGluXG4gICAgICAgIC8vIGBkZWluaXQoKWAuXG4gICAgICAgIC8vIFRPRE86IFRoZSB1c2VyIG1pZ2h0IGVuYWJsZSB0aGlzIGJ5IHNldHRpbmcgdGhlIGF0dHJpYnV0ZSBsYXRlciwgc29cbiAgICAgICAgLy8gd2UgY2FuJ3Qgc2ltcGx5IHJlbHkgb24gaGF2aW5nIGl0IGluIGNvbnN0cnVjdG9yLCB3ZSBuZWVkIGFcbiAgICAgICAgLy8gZ2V0dGVyL3NldHRlciBsaWtlIG5vZGUgcHJvcGVydGllcy5cbiAgICAgICAgdGhpcy5pbml0V2ViR2woKVxuICAgIH1cblxuICAgIC8vIFRPRE86IHdlIG5lZWQgdG8gZGVpbml0IHdlYmdsIHRvby5cbiAgICBpbml0V2ViR2woKSB7XG4gICAgICAgIC8vIFRPRE86IHRoaXMgbmVlZHMgdG8gYmUgY2FuY2VsYWJsZSB0b28sIHNlYXJjaCBvdGhlciBjb2RlcyBmb3JcbiAgICAgICAgLy8gXCJtb3VudGNhbmNlbFwiIHRvIHNlZS5cbiAgICAgICAgdGhpcy5tb3VudFByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLndlYmdsRW5hYmxlZCA9ICEhdGhpcy5nZXRBdHRyaWJ1dGUoJ3dlYmdsZW5hYmxlZCcpXG4gICAgICAgICAgICBpZiAoIXRoaXMud2ViZ2xFbmFibGVkKSByZXR1cm5cbiAgICAgICAgICAgIHRoaXMud2ViR2xSZW5kZXJlclN0YXRlID0ge31cbiAgICAgICAgICAgIGdldFdlYkdsUmVuZGVyZXIoKS5pbml0R2wodGhpcylcbiAgICAgICAgfSlcbiAgICB9XG4gICAgLy9hc3luYyBpbml0V2ViR2woKSB7XG4gICAgICAgIC8vLy8gVE9ETzogdGhpcyBuZWVkcyB0byBiZSBjYW5jZWxhYmxlIHRvbywgc2VhcmNoIG90aGVyIGNvZGVzIGZvclxuICAgICAgICAvLy8vIFwibW91bnRjYW5jZWxcIiB0byBzZWUuXG4gICAgICAgIC8vYXdhaXQgdGhpcy5tb3VudFByb21pc2VcbiAgICAgICAgLy90aGlzLndlYmdsRW5hYmxlZCA9ICEhdGhpcy5nZXRBdHRyaWJ1dGUoJ3dlYmdsZW5hYmxlZCcpXG4gICAgICAgIC8vaWYgKCF0aGlzLndlYmdsRW5hYmxlZCkgcmV0dXJuXG4gICAgICAgIC8vdGhpcy53ZWJHbFJlbmRlcmVyU3RhdGUgPSB7fVxuICAgICAgICAvL2dldFdlYkdsUmVuZGVyZXIoKS5pbml0R2wodGhpcylcbiAgICAvL31cblxuICAgIF9zdGFydFNpemVQb2xsaW5nKCkge1xuICAgICAgICAvLyBOT1RFIFBvbGxpbmcgaXMgY3VycmVudGx5IHJlcXVpcmVkIGJlY2F1c2UgdGhlcmUncyBubyBvdGhlciB3YXkgdG8gZG8gdGhpc1xuICAgICAgICAvLyByZWxpYWJseSwgbm90IGV2ZW4gd2l0aCBNdXRhdGlvbk9ic2VydmVyLiBSZXNpemVPYnNlcnZlciBoYXNuJ3RcbiAgICAgICAgLy8gbGFuZGVkIGluIGJyb3dzZXJzIHlldC5cbiAgICAgICAgaWYgKCF0aGlzLl9zaXplUG9sbFRhc2spXG4gICAgICAgICAgICB0aGlzLl9zaXplUG9sbFRhc2sgPSBNb3Rvci5hZGRSZW5kZXJUYXNrKHRoaXMuX2NoZWNrU2l6ZS5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIC8vIE5PVEUsIHRoZSBaIGRpbWVuc2lvbiBvZiBhIHNjZW5lIGRvZXNuJ3QgbWF0dGVyLCBpdCdzIGEgZmxhdCBwbGFuZSwgc29cbiAgICAvLyB3ZSBoYXZlbid0IHRha2VuIHRoYXQgaW50byBjb25zaWRlcmF0aW9uIGhlcmUuXG4gICAgX2NoZWNrU2l6ZSgpIHtcblxuICAgICAgICAvLyBUaGUgc2NlbmUgaGFzIGEgcGFyZW50IGJ5IHRoZSB0aW1lIHRoaXMgaXMgY2FsbGVkIChzZWVcbiAgICAgICAgLy8gc3JjL2NvcmUvU2NlbmUjbW91bnQgd2hlcmUgX3N0YXJ0U2l6ZVBvbGxpbmcgaXMgY2FsbGVkKVxuICAgICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGVcbiAgICAgICAgY29uc3QgcGFyZW50U2l6ZSA9IHRoaXMuX3BhcmVudFNpemVcbiAgICAgICAgY29uc3Qgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKHBhcmVudClcbiAgICAgICAgY29uc3Qgd2lkdGggPSBwYXJzZUZsb2F0KHN0eWxlLndpZHRoKVxuICAgICAgICBjb25zdCBoZWlnaHQgPSBwYXJzZUZsb2F0KHN0eWxlLmhlaWdodClcblxuICAgICAgICAvLyBpZiB3ZSBoYXZlIGEgc2l6ZSBjaGFuZ2UsIHRyaWdnZXIgcGFyZW50c2l6ZWNoYW5nZVxuICAgICAgICBpZiAocGFyZW50U2l6ZS54ICE9IHdpZHRoIHx8IHBhcmVudFNpemUueSAhPSBoZWlnaHQpIHtcbiAgICAgICAgICAgIHBhcmVudFNpemUueCA9IHdpZHRoXG4gICAgICAgICAgICBwYXJlbnRTaXplLnkgPSBoZWlnaHRcblxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoJ3BhcmVudHNpemVjaGFuZ2UnLCBPYmplY3QuYXNzaWduKHt9LCBwYXJlbnRTaXplKSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9tYWtlSW1wZXJhdGl2ZUNvdW50ZXJwYXJ0KCkge1xuICAgICAgICByZXR1cm4gbmV3IFNjZW5lKHtcbiAgICAgICAgICAgIF9tb3Rvckh0bWxDb3VudGVycGFydDogdGhpc1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBAb3ZlcnJpZGUgKi9cbiAgICBnZXRTdHlsZXMoKSB7XG4gICAgICAgIHJldHVybiBzdHlsZXNcbiAgICB9XG5cbiAgICBkZWluaXQoKSB7XG4gICAgICAgIHN1cGVyLmRlaW5pdCgpXG5cbiAgICAgICAgdGhpcy5pbXBlcmF0aXZlQ291bnRlcnBhcnQudW5tb3VudCgpXG4gICAgfVxuXG4gICAgX3N0b3BTaXplUG9sbGluZygpIHtcbiAgICAgICAgTW90b3IucmVtb3ZlUmVuZGVyVGFzayh0aGlzLl9zaXplUG9sbFRhc2spXG4gICAgICAgIHRoaXMuX3NpemVQb2xsVGFzayA9IG51bGxcbiAgICB9XG59XG5cbi8vIFRoaXMgYXNzb2NpYXRlcyB0aGUgVHJhbnNmb3JtYWJsZSBnZXR0ZXJzL3NldHRlcnMgd2l0aCB0aGUgSFRNTC1BUEkgY2xhc3Nlcyxcbi8vIHNvIHRoYXQgdGhlIHNhbWUgZ2V0dGVycy9zZXR0ZXJzIGNhbiBiZSBjYWxsZWQgZnJvbSBIVE1MIHNpZGUgb2YgdGhlIEFQSS5cbnByb3h5R2V0dGVyc1NldHRlcnMoU2l6ZWFibGUsIEhUTUxTY2VuZSlcblxuZXhwb3J0IHtIVE1MU2NlbmUgYXMgZGVmYXVsdH1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBLE9BQU8sTUFBTSxNQUFNLG1CQUFtQjtBQUN0QyxPQUFPLEtBQUssTUFBTSxlQUFlO0FBQ2pDLE9BQU8sS0FBSyxNQUFNLGVBQWU7QUFDakMsT0FBTyxVQUFVLE1BQU0sb0JBQW9CO0FBQzNDLE9BQU8sUUFBUSxNQUFNLGtCQUFrQjtBQUN2QyxPQUFPLGdCQUFnQixNQUFNLHVCQUF1QjtBQUNwRCxPQUFPLGVBQWUsR0FBRyxtQkFBbUIsRUFBRSxtQkFBbUIsT0FBTyxtQkFBbUI7QUFDM0YsT0FBTyxLQUFLLE1BQU0sdUJBQXVCOzs7O0FBSXpDLE9BQU8sR0FBRyxNQUFNLGtCQUFrQjs7QUFFbEMsbUJBQW1CLEVBQUU7O0FBRXJCLE1BQU0sUUFBUSxHQUFHLElBQUksT0FBTyxFQUFFO0FBQzlCLE1BQU0sQ0FBQyxHQUFHLFFBQVEsSUFBSTtJQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFBLFFBQVEsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFF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